#
# {{ ansible_managed }}
#
# This file was generated by Ansible for {{ ansible_fqdn }}
# Do NOT modify this file by hand!
#
# The MySQL database server configuration file.
#

[client]
port                      = {{ mysql_port }}
socket                    = {{ mysql_socket }}

[mysqld_safe]
socket                    = {{ mysql_socket }}
nice                      = 0

[mysqld]
#
# Basic settings
#
user                      = mysql
pid-file                  = {{ mysql_pid_file }}
socket                    = {{ mysql_socket }}
port                      = {{ mysql_port }}
basedir                   = /usr
datadir                   = {{ mysql_datadir }}
tmpdir                    = /tmp
{% if ansible_os_family == 'Debian' %}
lc-messages-dir           = /usr/share/mysql
{% endif %}
skip-external-locking
bind-address              = {{ mysql_bind_address }}


#
# Fine tuning
#
key_buffer_size           = 16M
max_allowed_packet        = 16M
thread_stack              = 192K
thread_cache_size         = 8

# This replaces the startup script and checks MyISAM tables if needed
# the first time they are touched
myisam-recover-options    = BACKUP


#
# Logging and replication
#
log_error                  = /var/log/mysql/error.log
server-id                  = {{ mysql_server_id|default('1') }}
{% if _mysql_version.version.major < 8 %}
expire_logs_days           = {{ mysql_expire_logs_days|default(10) }}
{% else %}
binlog_expire_logs_seconds = {{ mysql_expire_logs_days|default(10) * 24 * 60 * 60 }}
{% endif %}
max_binlog_size            = 100M


#
# Security features
#

# Disabling symbolic-links is recommended to prevent assorted security risks
#symbolic-links            = 0

{% if mysql_force_tls|bool %}
# Require secure transport for connections (TLS or sockets)
require-secure-transport  = ON
{% endif %}

# ssl-ca                    = /etc/mysql/cacert.pem
# ssl-cert                  = /etc/mysql/server-cert.pem
# ssl-key                   = /etc/mysql/server-key.pem
